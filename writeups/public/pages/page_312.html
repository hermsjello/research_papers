<!DOCTYPE html>
<html lang="en-US">
<head><script type="text/javascript" src="/_static/js/bundle-playback.js?v=HxkREWBo" charset="utf-8"></script>
<script type="text/javascript" src="/_static/js/wombat.js?v=txqj7nKC" charset="utf-8"></script>
<script>window.RufflePlayer=window.RufflePlayer||{};window.RufflePlayer.config={"autoplay":"on","unmuteOverlay":"hidden"};</script>
<script type="text/javascript" src="/_static/js/ruffle/ruffle.js"></script>
<script type="text/javascript">
    __wm.init("https://web.archive.org/web");
  __wm.wombat("http://incidentsecurity.com/how-spending-our-saturday-hacking-earned-us-20k/","20201028215444","https://web.archive.org/","web","/_static/",
	      "1603922084");
</script>
<link rel="stylesheet" type="text/css" href="/_static/css/banner-styles.css?v=S1zqJCYt" />
<link rel="stylesheet" type="text/css" href="/_static/css/iconochive.css?v=3PDvdIFv" />
<!-- End Wayback Rewrite JS Include -->

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<link rel="profile" href="http://gmpg.org/xfn/11">
<link rel="pingback" href="http://incidentsecurity.com/xmlrpc.php">
<title>How spending our Saturday hacking earned us 20k &#8211; Incident Security</title>
<link rel="dns-prefetch" href="//web.archive.org/web/20201028215444/http://fonts.googleapis.com/"/>
<link rel="dns-prefetch" href="//web.archive.org/web/20201028215444/http://s.w.org/"/>
<link rel="alternate" type="application/rss+xml" title="Incident Security » Feed" href="https://web.archive.org/web/20201028215444/http://incidentsecurity.com/feed/"/>
<link rel="alternate" type="application/rss+xml" title="Incident Security » Comments Feed" href="https://web.archive.org/web/20201028215444/http://incidentsecurity.com/comments/feed/"/>
<link rel="alternate" type="application/rss+xml" title="Incident Security » How spending our Saturday hacking earned us 20k Comments Feed" href="https://web.archive.org/web/20201028215444/http://incidentsecurity.com/how-spending-our-saturday-hacking-earned-us-20k/feed/"/>
		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/web.archive.org\/web\/20201028215444\/https:\/\/s.w.org\/images\/core\/emoji\/12.0.0-1\/72x72\/","ext":".png","svgUrl":"https:\/\/web.archive.org\/web\/20201028215444\/https:\/\/s.w.org\/images\/core\/emoji\/12.0.0-1\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/web.archive.org\/web\/20201028215444\/http:\/\/incidentsecurity.com\/wp-includes\/js\/wp-emoji-release.min.js?ver=5.3.4"}};
			!function(e,a,t){var r,n,o,i,p=a.createElement("canvas"),s=p.getContext&&p.getContext("2d");function c(e,t){var a=String.fromCharCode;s.clearRect(0,0,p.width,p.height),s.fillText(a.apply(this,e),0,0);var r=p.toDataURL();return s.clearRect(0,0,p.width,p.height),s.fillText(a.apply(this,t),0,0),r===p.toDataURL()}function l(e){if(!s||!s.fillText)return!1;switch(s.textBaseline="top",s.font="600 32px Arial",e){case"flag":return!c([127987,65039,8205,9895,65039],[127987,65039,8203,9895,65039])&&(!c([55356,56826,55356,56819],[55356,56826,8203,55356,56819])&&!c([55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447],[55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447]));case"emoji":return!c([55357,56424,55356,57342,8205,55358,56605,8205,55357,56424,55356,57340],[55357,56424,55356,57342,8203,55358,56605,8203,55357,56424,55356,57340])}return!1}function d(e){var t=a.createElement("script");t.src=e,t.defer=t.type="text/javascript",a.getElementsByTagName("head")[0].appendChild(t)}for(i=Array("flag","emoji"),t.supports={everything:!0,everythingExceptFlag:!0},o=0;o<i.length;o++)t.supports[i[o]]=l(i[o]),t.supports.everything=t.supports.everything&&t.supports[i[o]],"flag"!==i[o]&&(t.supports.everythingExceptFlag=t.supports.everythingExceptFlag&&t.supports[i[o]]);t.supports.everythingExceptFlag=t.supports.everythingExceptFlag&&!t.supports.flag,t.DOMReady=!1,t.readyCallback=function(){t.DOMReady=!0},t.supports.everything||(n=function(){t.readyCallback()},a.addEventListener?(a.addEventListener("DOMContentLoaded",n,!1),e.addEventListener("load",n,!1)):(e.attachEvent("onload",n),a.attachEvent("onreadystatechange",function(){"complete"===a.readyState&&t.readyCallback()})),(r=t.source||{}).concatemoji?d(r.concatemoji):r.wpemoji&&r.twemoji&&(d(r.twemoji),d(r.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
	<link rel="stylesheet" id="wp-block-library-css" href="https://web.archive.org/web/20201028215444cs_/http://incidentsecurity.com/wp-includes/css/dist/block-library/style.min.css?ver=5.3.4" type="text/css" media="all"/>
<link rel="stylesheet" id="elegantwp-maincss-css" href="https://web.archive.org/web/20201028215444cs_/http://incidentsecurity.com/wp-content/themes/elegantwp/style.css" type="text/css" media="all"/>
<link rel="stylesheet" id="font-awesome-css" href="https://web.archive.org/web/20201028215444cs_/http://incidentsecurity.com/wp-content/themes/elegantwp/assets/css/font-awesome.min.css" type="text/css" media="all"/>
<link rel="stylesheet" id="elegantwp-webfont-css" href="//web.archive.org/web/20201028215444cs_/http://fonts.googleapis.com/css?family=Playfair+Display:400,400i,700,700i|Domine:400,700|Oswald:400,700|Poppins:400,400i,700,700i" type="text/css" media="all"/>
<script type="text/javascript" src="https://web.archive.org/web/20201028215444js_/http://incidentsecurity.com/wp-includes/js/jquery/jquery.js?ver=1.12.4-wp"></script>
<script type="text/javascript" src="https://web.archive.org/web/20201028215444js_/http://incidentsecurity.com/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.4.1"></script>
<!--[if lt IE 9]>
<script type='text/javascript' src='http://incidentsecurity.com/wp-content/themes/elegantwp/assets/js/html5shiv.min.js'></script>
<![endif]-->
<!--[if lt IE 9]>
<script type='text/javascript' src='http://incidentsecurity.com/wp-content/themes/elegantwp/assets/js/respond.min.js'></script>
<![endif]-->
<link rel="https://api.w.org/" href="http://incidentsecurity.com/wp-json/"/>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://incidentsecurity.com/xmlrpc.php?rsd"/>
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://incidentsecurity.com/wp-includes/wlwmanifest.xml"/> 
<link rel="prev" title="ATutor 2.2.4 ‘language_import’ Arbitrary File Upload / RCE (CVE-2019-12169)" href="https://web.archive.org/web/20201028215444/http://incidentsecurity.com/atutor-2-2-4-language_import-arbitrary-file-upload-rce/"/>
<link rel="next" title="FUDForum 3.0.9 – Stored XSS / Remote Code Execution (CVE-2019-18839, CVE-2019-18873)" href="https://web.archive.org/web/20201028215444/http://incidentsecurity.com/fudforum-3-0-9-xss-remote-code-execution/"/>
<meta name="generator" content="WordPress 5.3.4"/>
<link rel="canonical" href="https://web.archive.org/web/20201028215444/http://incidentsecurity.com/how-spending-our-saturday-hacking-earned-us-20k/"/>
<link rel="shortlink" href="https://web.archive.org/web/20201028215444/http://incidentsecurity.com/?p=410"/>
<link rel="alternate" type="application/json+oembed" href="https://web.archive.org/web/20201028215444/http://incidentsecurity.com/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fincidentsecurity.com%2Fhow-spending-our-saturday-hacking-earned-us-20k%2F"/>
<link rel="alternate" type="text/xml+oembed" href="https://web.archive.org/web/20201028215444/http://incidentsecurity.com/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fincidentsecurity.com%2Fhow-spending-our-saturday-hacking-earned-us-20k%2F&amp;format=xml"/>
<style type="text/css">.recentcomments a{display:inline !important;padding:0 !important;margin:0 !important;}</style><style type="text/css" id="custom-background-css">
body.custom-background { background-color: #000000; }
</style>
	
</head>

<body class="post-template-default single single-post postid-410 single-format-standard custom-background elegantwp-animated elegantwp-fadein" id="elegantwp-site-body" itemscope="itemscope" itemtype="http://schema.org/WebPage">

<div class="elegantwp-outer-wrapper-full">
<div class="elegantwp-outer-wrapper">

<div class="elegantwp-container elegantwp-secondary-menu-container clearfix">
<div class="elegantwp-secondary-menu-container-inside clearfix">

<nav class="elegantwp-nav-secondary" id="elegantwp-secondary-navigation" itemscope="itemscope" itemtype="http://schema.org/SiteNavigationElement" role="navigation">
<ul id="elegantwp-menu-secondary-navigation" class="elegantwp-secondary-nav-menu elegantwp-menu-secondary"><li><a href="https://web.archive.org/web/20201028215444/http://incidentsecurity.com/">Home</a></li><li class="page_item page-item-2"><a href="https://web.archive.org/web/20201028215444/http://incidentsecurity.com/about-us/">About Us</a></li><li class="page_item page-item-155"><a href="https://web.archive.org/web/20201028215444/http://incidentsecurity.com/permission-memo/">Permission Memo</a></li></ul></nav>

</div>
</div>

<div class="elegantwp-container" id="elegantwp-header" itemscope="itemscope" itemtype="http://schema.org/WPHeader" role="banner">
<div class="elegantwp-head-content clearfix" id="elegantwp-head-content">


<div class="elegantwp-header-inside clearfix">
<div id="elegantwp-logo">
    <div class="site-branding">
      <h1 class="elegantwp-site-title"><a href="https://web.archive.org/web/20201028215444/http://incidentsecurity.com/" rel="home">Incident Security</a></h1>
      <p class="elegantwp-site-description">Penetration Testing, Security Research.</p>
    </div>
</div><!--/#elegantwp-logo -->

<div id="elegantwp-header-banner">
</div><!--/#elegantwp-header-banner -->
</div>

</div><!--/#elegantwp-head-content -->
</div><!--/#elegantwp-header -->

<div class="elegantwp-container elegantwp-primary-menu-container clearfix">
<div class="elegantwp-primary-menu-container-inside clearfix">

<nav class="elegantwp-nav-primary" id="elegantwp-primary-navigation" itemscope="itemscope" itemtype="http://schema.org/SiteNavigationElement" role="navigation">
<ul id="elegantwp-menu-primary-navigation" class="elegantwp-nav-primary-menu elegantwp-menu-primary"><li><a href="https://web.archive.org/web/20201028215444/http://incidentsecurity.com/">Home</a></li><li class="page_item page-item-2"><a href="https://web.archive.org/web/20201028215444/http://incidentsecurity.com/about-us/">About Us</a></li><li class="page_item page-item-155"><a href="https://web.archive.org/web/20201028215444/http://incidentsecurity.com/permission-memo/">Permission Memo</a></li></ul></nav>


<div class="elegantwp-top-social-icons">
                <a href="https://web.archive.org/web/20201028215444/https://twitter.com/JosephMcpeters" target="_blank" class="elegantwp-social-icon-twitter" title="Twitter"><i class="fa fa-twitter" aria-hidden="true"></i></a>                            <a href="https://web.archive.org/web/20201028215444/https://www.linkedin.com/in/joseph-mcpeters/" target="_blank" class="elegantwp-social-icon-linkedin" title="Linkedin"><i class="fa fa-linkedin" aria-hidden="true"></i></a>                                        <a href="https://web.archive.org/web/20201028215444/https://github.com/fuzzlove/" target="_blank" class="elegantwp-social-icon-github" title="Github"><i class="fa fa-github" aria-hidden="true"></i></a>                                                                                <a href="https://web.archive.org/web/20201028215444/mailto:admin@incidentsecurity.com" class="elegantwp-social-icon-email" title="Email Us"><i class="fa fa-envelope" aria-hidden="true"></i></a>        <a href="#" title="Search" class="elegantwp-social-search-icon"><i class="fa fa-search"></i></a>
</div>


<div class="elegantwp-social-search-box">

<form role="search" method="get" class="elegantwp-search-form" action="https://web.archive.org/web/20201028215444/http://incidentsecurity.com/">
<label>
    <span class="screen-reader-text">Search for:</span>
    <input type="search" class="elegantwp-search-field" placeholder="Search …" value="" name="s"/>
</label>
<input type="submit" class="elegantwp-search-submit" value="Search"/>
</form></div>

</div>
</div>




<div class="elegantwp-container clearfix" id="elegantwp-wrapper">
<div class="elegantwp-content-wrapper clearfix" id="elegantwp-content-wrapper">
<div class="elegantwp-main-wrapper clearfix" id="elegantwp-main-wrapper" itemscope="itemscope" itemtype="http://schema.org/Blog" role="main">
<div class="theiaStickySidebar">
<div class="elegantwp-main-wrapper-inside clearfix">


<div class="elegantwp-featured-posts-area elegantwp-featured-posts-area-top clearfix">

</div>


<div class="elegantwp-posts-wrapper" id="elegantwp-posts-wrapper">


    
<article id="post-410" class="elegantwp-post-singular post-410 post type-post status-publish format-standard hentry category-uncategorized wpcat-1-id">

    <header class="entry-header">
        <div class="elegantwp-entry-meta-single elegantwp-entry-meta-single-top"><span class="elegantwp-entry-meta-single-cats"><i class="fa fa-folder-open-o"></i>&nbsp;<span class="screen-reader-text">Posted in </span><a href="https://web.archive.org/web/20201028215444/http://incidentsecurity.com/category/uncategorized/" rel="category tag">Uncategorized</a></span></div>
        <h1 class="post-title entry-title"><a href="https://web.archive.org/web/20201028215444/http://incidentsecurity.com/how-spending-our-saturday-hacking-earned-us-20k/" rel="bookmark">How spending our Saturday hacking earned us 20k</a></h1>
                <div class="elegantwp-entry-meta-single">
    <span class="elegantwp-entry-meta-single-author"><i class="fa fa-user-circle-o"></i>&nbsp;<span class="author vcard" itemscope="itemscope" itemtype="http://schema.org/Person" itemprop="author"><a class="url fn n" href="https://web.archive.org/web/20201028215444/http://incidentsecurity.com/author/liquidsky/">McPeters Joseph</a></span></span>    <span class="elegantwp-entry-meta-single-date"><i class="fa fa-clock-o"></i>&nbsp;August 21, 2019</span>        <span class="elegantwp-entry-meta-single-comments"><i class="fa fa-comments-o"></i>&nbsp;<a href="https://web.archive.org/web/20201028215444/http://incidentsecurity.com/how-spending-our-saturday-hacking-earned-us-20k/#respond">Leave a comment</a></span>
            </div>
        </header><!-- .entry-header -->

    <div class="entry-content clearfix">
            <p>Note: I have personally archived this amazing article due to the fact that the original is no longer available.</p>
<h1 id="fc47" class="graf graf--h3 graf--leading graf--title">How spending our Saturday hacking earned us 20k</h1>
<div class="uiScale uiScale-ui--regular uiScale-caption--regular u-flexCenter u-marginVertical24 u-fontSize15 js-postMetaLockup">
<div class="u-flex0"></div>
<div class="u-flex1 u-paddingLeft15 u-overflowHidden">
<div class="u-paddingBottom3">Matti Bijnens</div>
</div>
</div>
<section class="section section--body section--first">
<div class="section-content">
<div class="section-inner sectionLayout--insetColumn">
<div class="uiScale uiScale-ui--regular uiScale-caption--regular u-flexCenter u-marginVertical24 u-fontSize15 js-postMetaLockup">
<div class="u-flex1 u-paddingLeft15 u-overflowHidden">
<div class="ui-caption u-noWrapWithEllipsis js-testPostMetaInlineSupplemental"><time datetime="2019-06-14T10:43:39.317Z">Jun 14</time></div>
</div>
</div>
<figure id="658a" class="graf graf--figure graf-after--h3">
<div class="aspectRatioPlaceholder is-locked">
<div class="aspectRatioPlaceholder-fill"></div>
<p><img class="aligncenter wp-image-412 size-full" src="https://web.archive.org/web/20201028215444im_/http://incidentsecurity.com/wp-content/uploads/2019/08/20k.png" alt="" width="840" height="470" srcset="https://web.archive.org/web/20201028215444im_/http://incidentsecurity.com/wp-content/uploads/2019/08/20k.png 840w, https://web.archive.org/web/20201028215444im_/http://incidentsecurity.com/wp-content/uploads/2019/08/20k-300x168.png 300w, https://web.archive.org/web/20201028215444im_/http://incidentsecurity.com/wp-content/uploads/2019/08/20k-768x430.png 768w, https://web.archive.org/web/20201028215444im_/http://incidentsecurity.com/wp-content/uploads/2019/08/20k-700x392.png 700w" sizes="(max-width: 840px) 100vw, 840px"/></p>
</div>
</figure>
<p id="48ae" class="graf graf--p graf-after--figure">Intigriti organised a hacking event in which Arne Swinnen, Jeroen Beckers and I managed to earn a total of €20.000 in bounties. We earned this by bypassing one of the targets main IDOR defense mechanisms.</p>
<p id="1b43" class="graf graf--p graf-after--p">People often ask us bug hunters what our thought process was before finding a bug. In this article I try to dive deeper into my thought process, and the bugs that we found because of it.</p>
<p id="1d87" class="graf graf--p graf-after--p"><strong class="markup--strong markup--p-strong"><em class="markup--em markup--p-em">Disclaimer</em></strong><em class="markup--em markup--p-em">: Because of the nature of the target, all endpoints have different names.</em></p>
<p id="e3b4" class="graf graf--p graf-after--p">The target was quite hardened and had multiple layers of defense. Besides the regular IDOR defense they also had, what we believed to be, “encrypted parameters”.</p>
<p>&nbsp;</p>
<p class="graf graf--p graf-after--p">An example of a request:</p>
<p><script src="https://web.archive.org/web/20201028215444js_/https://gist.github.com/sanderblaadjes/943a238e75045fcf5f909beec94cba92.js"></script></p>
<p id="638d" class="graf graf--p graf-after--figure">I first saw this at the start of the event and immediately started to think of ways to bypass or ‘crack’ this layer of defense. Here are some of the first things that popped into my mind when looking at the target:</p>
<ul class="postList">
<li id="1cd4" class="graf graf--li graf-after--p">Maybe the ‘E’ value is ignored? So we can just change the ‘V’ value and test for IDOR’s?</li>
<li id="cac1" class="graf graf--li graf-after--li">Maybe the E value is generated in the front-end and we can reverse engineer the algorithm and sign our own values?</li>
<li id="a418" class="graf graf--li graf-after--li">What if we change the type? Or delete the E value? Will the system fallback on the unencrypted values?</li>
</ul>
<p id="86e6" class="graf graf--p graf-after--li">I started testing my first thought and just edited the V value. The results were very misleading because requests appeared to give no errors. Eventually it turned out the V value was (almost) always ignored and they only looked at the E value. For some endpoints the system did look at the V value and ignored the E value.</p>
<p id="9a96" class="graf graf--p graf-after--p graf--trailing">In these instances where the system was looking at the V value, we would stumble upon the next layer of IDOR defense. Their second layer of IDOR defense would give us messages like: <strong class="markup--strong markup--p-strong"><em class="markup--em markup--p-em">This doesn’t seem to be working, try again or contact us.</em></strong></p>
</div>
</div>
</section>
<section class="section section--body">
<div class="section-divider">
<hr class="section-divider"/>
</div>
<div class="section-content">
<div class="section-inner sectionLayout--insetColumn">
<p id="bec3" class="graf graf--p graf--leading graf--trailing">I went on to testing my second idea, perhaps the E value was generated in the front-end. It didn’t take long before I realized these values were always present in the response of the previous request and thus gave up on this idea. However I did spend a little time trying to find out if I could “guess” what encryption method was being used. I couldn’t make any sense out of it however. One thing was clear though: you can get different E values back for the same V value. But the server only accepts the last generated E value. This lead us to believe some kind of timestamp was included within the E value.</p>
</div>
</div>
</section>
<section class="section section--body">
<div class="section-divider">
<hr class="section-divider"/>
</div>
<div class="section-content">
<div class="section-inner sectionLayout--insetColumn">
<p id="2be9" class="graf graf--p graf--leading graf--trailing">When changing the T (type) value of the requests to something else (none, hidden, number, …). You would get the same error like when trying to change the E value: <strong class="markup--strong markup--p-strong"><em class="markup--em markup--p-em">This doesn’t seem to be working, try again or contact us. So this</em></strong></p>
</div>
</div>
</section>
<section class="section section--body section--last">
<div class="section-divider">
<hr class="section-divider"/>
</div>
<div class="section-content">
<div class="section-inner sectionLayout--insetColumn">
<p id="893d" class="graf graf--p graf--leading">I started running out of ideas when suddenly Arne gave me the brilliant idea to find a <em class="markup--em markup--p-em">signing oracle</em>. The signing oracle would give us the encrypted E if we give it a plaintext V value. For example, say there exist an endpoint /encryptValue which accepts parameters ‘V’ and replies with value ‘E’. We give it our ‘V’ value (id=6548116) and it replies with the ‘E’ value (E=bm90YWN0dWFsbHliYXNlNjQ).</p>
<p id="ecb5" class="graf graf--p graf-after--p">There is no way to know how this E value is generated. Is it some kind of hash with trailing / prepended data? Is it encrypted? We simply don’t know, but that is fine. The backend would accept this E value and decrypt it, that’s all that matters.</p>
<p id="588c" class="graf graf--p graf-after--p">I started searching for “oracle signing” endpoints and quickly stumbled upon the fact that your username also has an ‘E’ value. So simply changing your username gives you back the ‘E’ value for your username.</p>
<p id="465d" class="graf graf--p graf-after--p">I started checking some endpoints with incremental numbers in an attempt to find out whether this idea actually worked. I had already been going through the application for half a day so I knew there was a “/getInvoice” endpoint which accepts the ID of an invoice (12340).</p>
<figure id="6980" class="graf graf--figure graf-after--p">
<div class="aspectRatioPlaceholder is-locked">
<div class="aspectRatioPlaceholder-fill"></div>
<p><img class="aligncenter wp-image-417 size-large" src="https://web.archive.org/web/20201028215444im_/http://incidentsecurity.com/wp-content/uploads/2019/08/20k2-700x366.png" alt="" width="700" height="366" srcset="https://web.archive.org/web/20201028215444im_/http://incidentsecurity.com/wp-content/uploads/2019/08/20k2-700x366.png 700w, https://web.archive.org/web/20201028215444im_/http://incidentsecurity.com/wp-content/uploads/2019/08/20k2-300x157.png 300w, https://web.archive.org/web/20201028215444im_/http://incidentsecurity.com/wp-content/uploads/2019/08/20k2-768x401.png 768w, https://web.archive.org/web/20201028215444im_/http://incidentsecurity.com/wp-content/uploads/2019/08/20k2.png 1016w" sizes="(max-width: 700px) 100vw, 700px"/></p>
</div>
</figure>
<p id="af52" class="graf graf--p graf-after--figure">To test if the oracle bug worked I updated my username to the invoice ID +1 (12341). I copied the E value from my username to the E value in the request and sent the request. I was quite astonished when I saw the request gave another error. I did not receive the invoice with the ID I requested, but I knew the oracle was working.</p>
<p id="d717" class="graf graf--p graf-after--p">Usually when the ‘E’ value was incorrect, you would get an error like this: <strong class="markup--strong markup--p-strong"><em class="markup--em markup--p-em">This doesn’t seem to be working, try again or contact us. </em></strong>However, this time I got another error: <strong class="markup--strong markup--p-strong"><em class="markup--em markup--p-em">Entity does not belong to client</em></strong></p>
<p id="515e" class="graf graf--p graf-after--p">Although this might seem like just another error, this was quite a breakthrough. This error indicated the server was accepting our E value, but that one of their next IDOR checks was successfully stopping us. We managed to bypass one of the layers of IDOR defense the company had.</p>
<p id="7fcb" class="graf graf--p graf-after--p">Because we were at a live hacking event I shared this knowledge with Arne &amp; Jeroen, hoping they would find something with this bug.</p>
<p id="e974" class="graf graf--p graf-after--p">We quickly went through all of the ‘sensitive’ endpoints we could think of that included some kind of guessable or incremental ID. Unfortunately we were dealing with quite a hardened target and finding an endpoint with a missing second authorization check was quite a pain.</p>
<p id="c0f9" class="graf graf--p graf-after--p">One of the endpoints I looked at was the <strong class="markup--strong markup--p-strong">/getArchive</strong> endpoint. This endpoint would return all bills / earnings you ever received. Unlike other endpoints this one behaved a little different. Most other endpoints included your ID using a field of type “text”. This endpoint expected a field of type “hidden” however. See the example below</p>
<figure id="d34d" class="graf graf--figure graf--iframe graf-after--p">
<div class="aspectRatioPlaceholder is-locked">
<div class="aspectRatioPlaceholder-fill"></div>
<p><script src="https://web.archive.org/web/20201028215444js_/https://gist.github.com/sanderblaadjes/a4900f065a0f481666a90048f41fb32b.js"></script></p>
</div>
</figure>
<p id="2b59" class="graf graf--p graf-after--figure">Because the type was hidden, there was no value in the request either. There was no way of knowing what this E was. I had a strong feeling this would be my user ID. What else could it have been?</p>
<p id="4953" class="graf graf--p graf-after--p">I quickly set my username to my userID and supplied the E value to this endpoint. Initially this didn’t work as I got the following error: <strong class="markup--strong markup--p-strong"><em class="markup--em markup--p-em">Could not find client with this ID. </em></strong>In previous endpoints I had noticed that sometimes only the last part of your user ID is sent. I cut the first part of my user ID and tried again. This worked and gave me back my archive.</p>
<p id="61c9" class="graf graf--p graf-after--p">This meant that the hidden field was indeed my user ID. I asked the user ID of Jeroen and quickly tried with his account. The request went through and I got a full archive of Jeroen’s bills and earnings.</p>
<p id="764d" class="graf graf--p graf-after--p">I quickly (perhaps a little “too” quick) sent in the report and marked it with a CVSS score of 7.7 (High severity). Because we were at a live hacking event the team immediately looked at the report. I forgot to explain some important steps in my report and thus the development team did not quite understand the report. So they asked me if I could present my finding for them.</p>
<figure id="955c" class="graf graf--figure graf-after--p">
<div class="aspectRatioPlaceholder is-locked">
<div class="aspectRatioPlaceholder-fill"></div>
<p><img class="aligncenter wp-image-422 size-full" src="https://web.archive.org/web/20201028215444im_/http://incidentsecurity.com/wp-content/uploads/2019/08/20k3.png" alt="" width="501" height="53" srcset="https://web.archive.org/web/20201028215444im_/http://incidentsecurity.com/wp-content/uploads/2019/08/20k3.png 501w, https://web.archive.org/web/20201028215444im_/http://incidentsecurity.com/wp-content/uploads/2019/08/20k3-300x32.png 300w" sizes="(max-width: 501px) 100vw, 501px"/></p>
</div>
</figure>
<p id="cb07" class="graf graf--p graf-after--figure">I went to the room with the employees of the target and started setting up. As if 20 people watching you isn’t stressful enough already, the HDMI on my laptop wasn’t working with the projector. Fortunately Stijn (CEO of Intigriti) gave me his MacBook and asked me to showcase the demo on his machine. I had never worked on a Mac before and didn’t even know how to switch between burp and Firefox. I must’ve looked like an idiot in front of all these people. When I finally managed to open Burp and Firefox I explained the many steps we had to take to finally achieve this bug:</p>
<ol class="postList">
<li id="bbde" class="graf graf--li graf-after--p">Change your username to someone else’s ID.</li>
<li id="a305" class="graf graf--li graf-after--li">Use the E value of your username in this request</li>
<li id="8e6c" class="graf graf--li graf-after--li">We figured out the “Hidden” value was just your user id.</li>
</ol>
<p id="fc87" class="graf graf--p graf-after--li">I gave the demo with the account of Jeroen. However, one of the people attending the meeting wanted me to try this with his ID. I went through the process again and eventually got access to his full archive. You could immediately see everyone in the room had a clear understanding of the impact of this vulnerability.</p>
<p id="c5c4" class="graf graf--p graf-after--p">By the time I had settled back in my chair an Intigriti member came by to tell me the company decided to change the criticality from <strong class="markup--strong markup--p-strong">high</strong> to <strong class="markup--strong markup--p-strong">exceptional</strong>. I was quite happy with this because this equals a bounty of €10.000.</p>
<figure id="e3bf" class="graf graf--figure graf-after--p">
<div class="aspectRatioPlaceholder is-locked">
<div class="aspectRatioPlaceholder-fill"></div>
<p><img class="wp-image-428 size-full aligncenter" src="https://web.archive.org/web/20201028215444im_/http://incidentsecurity.com/wp-content/uploads/2019/08/20k4.png" alt="" width="662" height="127" srcset="https://web.archive.org/web/20201028215444im_/http://incidentsecurity.com/wp-content/uploads/2019/08/20k4.png 662w, https://web.archive.org/web/20201028215444im_/http://incidentsecurity.com/wp-content/uploads/2019/08/20k4-300x58.png 300w" sizes="(max-width: 662px) 100vw, 662px"/></p>
</div>
</figure>
<p id="376c" class="graf graf--p graf-after--figure">Meanwhile we were still hunting for more IDORs using our oracle bug. Arne found a way to get the total earnings of someone by just supplying their real name. He also got a chance to showcase his bug and just like me his bug was assigned a criticality of <strong class="markup--strong markup--p-strong">exceptional</strong>. Arne insisted to share 50% of his bounty with me because it wouldn’t have been possible without the oracle bug. I am still extremely thankful for this.</p>
<figure id="3269" class="graf graf--figure graf--iframe graf-after--p">
<div class="aspectRatioPlaceholder is-locked">
<div class="aspectRatioPlaceholder-fill"></div>
<p><script src="https://web.archive.org/web/20201028215444js_/https://gist.github.com/sanderblaadjes/89602f15ee1f5b5117bc5f31d065c472.js"></script></p>
</div>
</figure>
<p id="bc41" class="graf graf--p graf-after--figure">Jeroen managed to find a vulnerability where he was able to get access to the profile pictures of other users. Unlike most other targets, for this specific target profile pictures were not supposed to be public. He too earned a bounty for this.</p>
<p id="0c59" class="graf graf--p graf-after--p">After my presentation I had a little chat with the development team which cleared up a lot of things for me. First of all, there is not really any encryption going on. The ‘E’ value is just a randomly generated string that is ‘mapped’ to some cleartext value to make it <em class="markup--em markup--p-em">impossible</em> to perform IDORs, as you can’t guess the ID of another user.</p>
<figure id="5582" class="graf graf--figure graf-after--p">
<div class="aspectRatioPlaceholder is-locked">
<div class="aspectRatioPlaceholder-fill"></div>
<p><img class="wp-image-424 size-full aligncenter" src="https://web.archive.org/web/20201028215444im_/http://incidentsecurity.com/wp-content/uploads/2019/08/20k5.png" alt="" width="479" height="220" srcset="https://web.archive.org/web/20201028215444im_/http://incidentsecurity.com/wp-content/uploads/2019/08/20k5.png 479w, https://web.archive.org/web/20201028215444im_/http://incidentsecurity.com/wp-content/uploads/2019/08/20k5-300x138.png 300w" sizes="(max-width: 479px) 100vw, 479px"/></p>
</div>
</figure>
<p id="8acb" class="graf graf--p graf-after--figure">This ‘mapping’ is supposed to be per transaction only. This means that the E values should only be valid for one endpoint at a time. This would have prevented the E value of my username (/changeUsername) from working with the archive endpoint (/getArchive).</p>
<p id="65aa" class="graf graf--p graf-after--p">Both Arne and I received a bonus and a trophy. Arne got the trophy for best hacker which he definitely deserved. I received a trophy for finding the best bug and a bonus for being the first to find a critical bug.</p>
<p id="fa1b" class="graf graf--p graf-after--p">In the end I spent 75% of my day bypassing this layer of defense. While trying to find ways around it I constantly saw other hackers submitting reports and earning bounties. Although this got quite demotivating at times, I knew that finding a way around this layer of defense would be worth the effort.</p>
<h3 id="8c4d" class="graf graf--h3 graf-after--p">Some things to remember:</h3>
<ul class="postList">
<li id="3fff" class="graf graf--li graf-after--h3">No target is completely secure, everyone makes mistakes</li>
<li id="e446" class="graf graf--li graf-after--li">Don’t give up because you see some ‘advanced layer of defense’</li>
<li id="047d" class="graf graf--li graf-after--li">If possible, brainstorm with other hackers to get more ideas</li>
<li id="92ae" class="graf graf--li graf-after--li graf--trailing">Always write clear and detailed reports, unless you like presenting in front of 20 people</li>
</ul>
</div>
</div>
</section>
<p>Note: I have personally archived this amazing article due to the fact that the original is no longer available.</p>
    </div><!-- .entry-content -->

    <footer class="entry-footer">
            </footer><!-- .entry-footer -->

    
            <div class="elegantwp-author-bio">
            <div class="elegantwp-author-bio-top">
            <div class="elegantwp-author-bio-gravatar">
                <img alt="" src="https://web.archive.org/web/20201028215444im_/http://2.gravatar.com/avatar/e210e0d5a4cde567fd1ff1a742175106?s=80&amp;d=mm&amp;r=g" class="avatar avatar-80 photo" height="80" width="80"/>
            </div>
            <div class="elegantwp-author-bio-text">
                <h4>Author: <span><a href="https://web.archive.org/web/20201028215444/http://incidentsecurity.com/" title="Visit McPeters Joseph’s website" rel="author external">McPeters Joseph</a></span></h4>Joseph McPeters is a Security Researcher. He specializes in network and web application penetration testing. Contact: admin@incidentsecurity.com
            </div>
            </div>
            </div>
        
</article>
    
	<nav class="navigation post-navigation" role="navigation" aria-label="Posts">
		<h2 class="screen-reader-text">Post navigation</h2>
		<div class="nav-links"><div class="nav-previous"><a href="https://web.archive.org/web/20201028215444/http://incidentsecurity.com/atutor-2-2-4-language_import-arbitrary-file-upload-rce/" rel="prev">&larr; ATutor 2.2.4 &#8216;language_import&#8217; Arbitrary File Upload / RCE (CVE-2019-12169)</a></div><div class="nav-next"><a href="https://web.archive.org/web/20201028215444/http://incidentsecurity.com/fudforum-3-0-9-xss-remote-code-execution/" rel="next">FUDForum 3.0.9 &#8211; Stored XSS / Remote Code Execution (CVE-2019-18839, CVE-2019-18873) &rarr;</a></div></div>
	</nav>
    
<div id="comments" class="comments-area">

    	<div id="respond" class="comment-respond">
		<h3 id="reply-title" class="comment-reply-title">Leave a Reply <small><a rel="nofollow" id="cancel-comment-reply-link" href="/web/20201028215444/http://incidentsecurity.com/how-spending-our-saturday-hacking-earned-us-20k/#respond" style="display:none;">Cancel reply</a></small></h3><form action="https://web.archive.org/web/20201028215444/http://incidentsecurity.com/wp-comments-post.php" method="post" id="commentform" class="comment-form" novalidate><p class="comment-notes"><span id="email-notes">Your email address will not be published.</span> Required fields are marked <span class="required">*</span></p><p class="comment-form-comment"><label for="comment">Comment</label> <textarea id="comment" name="comment" cols="45" rows="8" maxlength="65525" required="required"></textarea></p><p class="comment-form-author"><label for="author">Name <span class="required">*</span></label> <input id="author" name="author" type="text" value="" size="30" maxlength="245" required="required"/></p>
<p class="comment-form-email"><label for="email">Email <span class="required">*</span></label> <input id="email" name="email" type="email" value="" size="30" maxlength="100" aria-describedby="email-notes" required="required"/></p>
<p class="comment-form-url"><label for="url">Website</label> <input id="url" name="url" type="url" value="" size="30" maxlength="200"/></p>
<p class="form-submit"><input name="submit" type="submit" id="submit" class="submit" value="Post Comment"/> <input type="hidden" name="comment_post_ID" value="410" id="comment_post_ID"/>
<input type="hidden" name="comment_parent" id="comment_parent" value="0"/>
</p></form>	</div><!-- #respond -->
	
</div><!-- #comments -->
<div class="clear"></div>

</div><!--/#elegantwp-posts-wrapper -->


<div class="elegantwp-featured-posts-area elegantwp-featured-posts-area-bottom clearfix">

</div>


</div>
</div>
</div><!-- /#elegantwp-main-wrapper -->


<div class="elegantwp-sidebar-one-wrapper elegantwp-sidebar-widget-areas clearfix" id="elegantwp-sidebar-one-wrapper" itemscope="itemscope" itemtype="http://schema.org/WPSideBar" role="complementary">
<div class="theiaStickySidebar">
<div class="elegantwp-sidebar-one-wrapper-inside clearfix">

<div id="custom_html-5" class="widget_text elegantwp-side-widget widget widget_custom_html"><h2 class="elegantwp-widget-title"><span>Resources</span></h2><div class="textwidget custom-html-widget"><a href="https://web.archive.org/web/20201028215444/https://www.exploit-db.com/">Exploit Database</a><br>
<a href="https://web.archive.org/web/20201028215444/https://www.corelan.be/">Corelan Team</a><br>
<a href="https://web.archive.org/web/20201028215444/https://www.offensive-security.com/">Offensive Security</a><br>
<a href="https://web.archive.org/web/20201028215444/https://portswigger.net/">Port Swigger</a></div></div>
</div>
</div>
</div><!-- /#elegantwp-sidebar-one-wrapper-->

<div class="elegantwp-sidebar-two-wrapper elegantwp-sidebar-widget-areas clearfix" id="elegantwp-sidebar-two-wrapper" itemscope="itemscope" itemtype="http://schema.org/WPSideBar" role="complementary">
<div class="theiaStickySidebar">
<div class="elegantwp-sidebar-two-wrapper-inside clearfix">

<div id="categories-4" class="elegantwp-side-widget widget widget_categories"><h2 class="elegantwp-widget-title"><span>Categories</span></h2>		<ul>
				<li class="cat-item cat-item-66"><a href="https://web.archive.org/web/20201028215444/http://incidentsecurity.com/category/exploits/">Exploits</a>
</li>
	<li class="cat-item cat-item-45"><a href="https://web.archive.org/web/20201028215444/http://incidentsecurity.com/category/penetration-testing/">Penetration Testing</a>
</li>
	<li class="cat-item cat-item-1"><a href="https://web.archive.org/web/20201028215444/http://incidentsecurity.com/category/uncategorized/">Uncategorized</a>
</li>
	<li class="cat-item cat-item-54"><a href="https://web.archive.org/web/20201028215444/http://incidentsecurity.com/category/web-application/">Web Application</a>
</li>
		</ul>
			</div>
</div>
</div>
</div><!-- /#elegantwp-sidebar-two-wrapper-->

</div><!--/#elegantwp-content-wrapper -->
</div><!--/#elegantwp-wrapper -->




<div class="clearfix" id="elegantwp-footer">
<div class="elegantwp-foot-wrap elegantwp-container">
  <p class="elegantwp-copyright">Copyright © 2019 Incident Security</p>

</div>
</div><!--/#elegantwp-footer -->

</div>
</div>

<script type="text/javascript" src="https://web.archive.org/web/20201028215444js_/http://incidentsecurity.com/wp-content/themes/elegantwp/assets/js/jquery.fitvids.min.js"></script>
<script type="text/javascript" src="https://web.archive.org/web/20201028215444js_/http://incidentsecurity.com/wp-content/themes/elegantwp/assets/js/ResizeSensor.min.js"></script>
<script type="text/javascript" src="https://web.archive.org/web/20201028215444js_/http://incidentsecurity.com/wp-content/themes/elegantwp/assets/js/theia-sticky-sidebar.min.js"></script>
<script type="text/javascript">
/* <![CDATA[ */
var elegantwp_ajax_object = {"ajaxurl":"https:\/\/web.archive.org\/web\/20201028215444\/http:\/\/incidentsecurity.com\/wp-admin\/admin-ajax.php","sticky_menu":"1","sticky_sidebar":"1"};
/* ]]> */
</script>
<script type="text/javascript" src="https://web.archive.org/web/20201028215444js_/http://incidentsecurity.com/wp-content/themes/elegantwp/assets/js/custom.js"></script>
<script type="text/javascript" src="https://web.archive.org/web/20201028215444js_/http://incidentsecurity.com/wp-includes/js/comment-reply.min.js?ver=5.3.4"></script>
<script type="text/javascript" src="https://web.archive.org/web/20201028215444js_/http://incidentsecurity.com/wp-includes/js/wp-embed.min.js?ver=5.3.4"></script>
</body>
</html><!--
     FILE ARCHIVED ON 21:54:44 Oct 28, 2020 AND RETRIEVED FROM THE
     INTERNET ARCHIVE ON 07:39:47 Jan 11, 2025.
     JAVASCRIPT APPENDED BY WAYBACK MACHINE, COPYRIGHT INTERNET ARCHIVE.

     ALL OTHER CONTENT MAY ALSO BE PROTECTED BY COPYRIGHT (17 U.S.C.
     SECTION 108(a)(3)).
-->
<!--
playback timings (ms):
  captures_list: 2.713
  exclusion.robots: 1.756
  exclusion.robots.policy: 0.046
  esindex: 0.021
  cdx.remote: 7.706
  LoadShardBlock: 5387.511 (3)
  PetaboxLoader3.datanode: 173.833 (5)
  PetaboxLoader3.resolve: 422.846 (3)
  load_resource: 445.384 (2)
-->